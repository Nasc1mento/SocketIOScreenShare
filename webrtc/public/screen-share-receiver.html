<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Screen Share Receiver</title>
  </head>
  <body>
    <button id="receive-screen-btn">Receive Screen</button>
    <video id="received-screen" autoplay></video>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const pc = new RTCPeerConnection();

      const receiveScreenBtn = document.querySelector('#receive-screen-btn');
      receiveScreenBtn.addEventListener('click', () => {
        pc.createOffer().then(offer => {
          pc.setLocalDescription(new RTCSessionDescription(offer));
          socket.emit('offer', offer);
        });
      });

      socket.on('answer', async answer => {
        await pc.setRemoteDescription(new RTCSessionDescription(answer));
      });

      pc.ontrack = event => {
        document.querySelector('#received-screen').srcObject = event.streams[0];
      };

      pc.onicecandidate = event => {
        if (event.candidate) {
          socket.emit('icecandidate', event.candidate);
        }
      };

      socket.on('icecandidate', async candidate => {
        await pc.addIceCandidate(new RTCIceCandidate(candidate));
      });
    </script>
  </body>
</html>
