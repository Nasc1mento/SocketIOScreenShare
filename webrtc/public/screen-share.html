<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Screen Share Example</title>
  </head>
  <body>
    <button id="share-screen-btn">Share Screen</button>
    <video id="screen-share" autoplay></video>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const pc = new RTCPeerConnection();
      const shareScreenBtn = document.querySelector('#share-screen-btn');
      shareScreenBtn.addEventListener('click', () => {
        navigator.mediaDevices.getDisplayMedia({ video: true, audio: false }).then(stream => {
          document.querySelector('#screen-share').srcObject = stream;
          stream.getTracks().forEach(track => pc.addTrack(track, stream));
        });
      });
      socket.on('answer', async answer => {
        await pc.setRemoteDescription(new RTCSessionDescription(answer));
      });
      pc.onicecandidate = event => {
        if (event.candidate) {
          socket.emit('icecandidate', event.candidate);
        }
      };
      socket.on('icecandidate', async candidate => {
        await pc.addIceCandidate(new RTCIceCandidate(candidate));
      });
      pc.createOffer().then(offer => {
        pc.setLocalDescription(new RTCSessionDescription(offer));
        socket.emit('offer', offer);
      });
    </script>
  </body>
</html>
